<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>CONFIG</title>

    <!-- Bootstrap -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
<!-- Modal -->
<div class="modal fade" id="spform" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">ADD NEW SP</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="spid">SPID</label>
                        <input type="number" class="form-control" id="spid" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="spname">SPNAME
                        </label>
                        <input type="text" class="form-control" id="spname" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="accessno">ACCESSNO</label>
                        <input type="number" class="form-control" id="accessno" placeholder="">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default">Close</button>
                        <button type="button" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="userform" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">ADD NEW USER</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="username">USERNAME</label>
                        <input type="text" class="form-control" id="username" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="password">PASSWORD</label>
                        <input type="password" class="form-control" id="password" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="level">LEVEL
                        </label>
                        <input type="number" class="form-control" id="level" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="splist">LIST</label>
                        <textarea class="form-control" id="splist" rows="10">
                            </textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default">Close</button>
                        <button type="button" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <ul class="nav nav-pills nav-stacked">
                <li class="active">
                    <a href="#spinfo" data-toggle="tab">SP</a></li>
                <li><a href="#userinfo" data-toggle="tab">USER</a></li>
                <li><a href="#cpinfo" data-toggle="tab">CP</a></li>
                <li><a href="#productinfo" data-toggle="tab">PRODUCT</a></li>
                <li><a href="#5" data-toggle="tab">Contact</a></li>
            </ul>
        </div>
        <div class="col-lg-9">
            <div class="tab-content">
                <div class="tab-pane active" id="spinfo">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#spform">
                        ADD
                    </button>
                    <button type="button" class="btn btn-primary edit">
                        EDIT
                    </button>
                    <button type="button" class="btn btn-primary delete">
                        DELETE
                    </button>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>SPID</th>
                            <th>SPNAME</th>
                            <th>ACCESSNO</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for sp in spinfos %}
                            <tr class="tr_sp">
                                <td>{{ sp.spid }}</td>
                                <td>{{ sp.spname }}</td>
                                <td>{{ sp.accessno }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="userinfo">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#userform">
                        ADD
                    </button>
                    <button type="button" class="btn btn-primary edit">
                        EDIT
                    </button>
                    <button type="button" class="btn btn-primary delete">
                        DELETE
                    </button>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>UID</th>
                            <th>USERNAME</th>
                            <th>LEVEL</th>
                            <th>LIST</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for user in users %}
                            <tr class="tr_user">
                                <td>{{ user.id }}</td>
                                <td>{{ user.name }}</td>
                                <td>{{ user.level }}</td>
                                <td>
                                    <div class="row">
                                        {% for key,value in user.namelist.items() %}
                                            <div class="col-sm-4">
                                                <p>{{ key }}</p>
                                            </div>
                                            <div class="col-sm-8">
                                                <p>{{ value }}</p>
                                            </div>
                                        {% endfor %}
                                    </div>

                                </td>

                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="3">
                    <p>You are watching Section 3.</p>
                </div>
            </div>
        </div>
    </div>

</div>
<div class="modal fade" id="confirm" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">确认</h4>
            </div>
            <div class="modal-body">
                <p class="content"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default cancel">取消</button>
                <button type="button" class="btn btn-primary ok">确认</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="../static/js/jquery-3.2.1.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../static/js/bootstrap.min.js"></script>

<script>
    $('.tr_sp').click(function () {
        $('.tr_sp').removeClass('active');
        $('.tr_user').removeClass('active');
        $(this).addClass('active');
    });
    $('#confirm .cancel').click(function () {
        $('#confirm').modal('hide');
    });
    $('#confirm .ok').click(function () {
        var selected_tr = $('#spinfo .active');
        if (selected_tr) {
            var spid = $($('#spinfo .active').children('td').get(0)).text();
            console.log(spid);
            $.ajax({
                url: '/api/v1.0/sp/' + spid,
                type: 'DELETE',
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    console.log(textStatus);
                    console.log(jqXHR);
                    $('.tr_sp.active').remove();
                    $('#confirm').modal('hide');
                },
                error: function (xhr, textStatus) {
                    console.log('错误');
                    console.log(xhr);
                    console.log(textStatus)
                }
            })
        }
        selected_tr = $('#userinfo .active');
        if (selected_tr) {
            var uid = $($('#userinfo .active').children('td').get(0)).text();
            console.log(uid);
            $.ajax({
                url: '/api/v1.0/user/' + uid,
                type: 'DELETE',
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    console.log(textStatus);
                    console.log(jqXHR);
                    $('.tr_user.active').remove();
                    $('#confirm').modal('hide');
                },
                error: function (xhr, textStatus) {
                    console.log('错误');
                    console.log(xhr);
                    console.log(textStatus)
                }
            })
        }

    });
    $('#spinfo .delete').click(function () {
        var selected_tr = $('#spinfo .active');
        if (selected_tr) {
            var spid = $($('#spinfo .active').children('td').get(0)).text();
            console.log(spid);
            $('#confirm .content').text('即将删除SP' + spid + ',是否确认？');
            $('#confirm').modal('show');
        }
    });

    $('#spform .btn:first').click(function () {
        $('#spform').modal('hide');
    });
    $('#spform .btn:last').click(function () {
        $.ajax({
            url: '/api/v1.0/sp',
            type: 'POST',
            data: {
                'id': $('#spid').val(),
                'spname': $('#spname').val(),
                'accessno': $('#accessno').val()
            },
            dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data, textStatus, jqXHR) {
                console.log(data);
                console.log(textStatus);
                console.log(jqXHR);
                $('.tr_sp:first').before('<tr class=\"tr_sp active\">' +
                        '<td>' + $('#spid').val() + '</td>' +
                        '<td>' + $('#spname').val() + '</td>' +
                        '<td>' + $('#accessno').val() + '</td>' +
                        '</tr>'
                )
            },
            error: function (xhr, textStatus) {
                console.log('错误');
                console.log(xhr);
                console.log(textStatus)
            }
        });
        $('#spform').modal('hide');
    });

    $('#userform .btn:first').click(function () {
        $('#userform').modal('hide');
    });
    $('#userform .btn:last').click(function () {
        var splist = $('#splist').val();
        splist = $.trim(splist).replace(/\n/g, ",");
        console.log(splist);
        $.ajax({
            url: '/api/v1.0/user',
            type: 'POST',
            data: {
                'username': $('#username').val(),
                'password': $('#password').val(),
                'level': $('#level').val(),
                'splist': splist
            },
            dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data, textStatus, jqXHR) {
                console.log(data);
                console.log(textStatus);
                console.log(jqXHR);
                window.location.reload();
            },
            error: function (xhr, textStatus) {
                console.log('错误');
                console.log(xhr);
                console.log(textStatus)
            }
        });
        $('#userform').modal('hide');
    });
    $('.tr_user').click(function () {
        $('.tr_user').removeClass('active');
        $('.tr_sp').removeClass('active');
        $(this).addClass('active');
    });
    $('#userinfo .edit').click(function () {
        var selected_tr = $('#userinfo .active');
        $('#username').val('');
        $('#level').val(2);
        $('#password').val('');
        if (selected_tr) {
            $('#username').val($(selected_tr.children('td').get(1)).text());
            $('#level').val($(selected_tr.children('td').get(2)).text());
            var splist = '';
            selected_tr.find('p').each(function (index) {
                if (index % 2 == 0) {
                    splist += $(this).text() + '\n';
                }
            })
            $('#splist').val(splist.substr(0, splist.length));
        }
        $('#userform').modal('show');
    });

    $('#userinfo .delete').click(function () {
        var selected_tr = $('#userinfo .active');
        if (selected_tr) {
            var username = $($('#userinfo .active').children('td').get(1)).text();
            console.log(username);
            $('#confirm .content').text('即将删除用户' + username + ',是否确认？');
            $('#confirm').modal('show');
        }
    });

</script>
</body>
</html>